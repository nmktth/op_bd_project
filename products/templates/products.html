<!-- products/templates/add_product.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ozon Parser üíÄ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/normalize.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <main>
        <header>
            <form id="add_product_form" method="POST">
                {% csrf_token %}
                
                <input type="hidden" name="_method" value="POST">
                <label for="url">
                    <input id="add_input" type="text" name="ozon" id="ozon" placeholder="–í–≤–æ–¥ —Å—Å—ã–ª–∫–∏ –æ–∑–æ–Ω —Ç–æ–≤–∞—Ä–∞">
                </label>
                <button type="submit" id="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
            
        </header>
        <section class="products">
            {% for product in all_products %}
                <div class="product">
                    <strong class="product_name" title="{{ product.name }}"><a href="{{ product.url }}" target="_blank">{{ product.name }}</a></strong>
                    <br>
                    <strong class="align_start">–ù–∞—á–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:</strong>
                    <p>{{ product.start_price }}‚ÇΩ</p>
                    <strong class="align_start">–ü—Ä–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–µ:</strong>
                    <p>{{ product.price }}‚ÇΩ</p>
                    <strong>–ö—É–ø–∏—Ç—å –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –Ω–∞:</strong>
                    <form id="add_procent_form" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="_method" value="UPDATE">
                        <input type="hidden" name="url" value="{{ product.url }}">
                        <label for="procent">
                            <input id="add_procent" type="text" name="procent" id="procent" placeholder="%" value="{{product.percent}}%">
                        </label>
                        <button type="submit" id="accept"><svg width="55" height="55" viewBox="0 0 55 55" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 26.5L25 46.5L50 5" stroke="white" stroke-width="10" stroke-linecap="round"/></svg></button>
                    </form>
                    <strong class="{% if product.cur_percent > 0 %} procent_plus {% endif %} {% if product.cur_percent < 0 %} procent_minus {% endif %} {% if product.cur_percent == 0 %} zero_procent {% endif %}">
                        {{product.cur_percent}}%
                    </strong>
                    <form id="del_product" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="_method" value="DELETE">
                        <input type="hidden" name="url" value="{{ product.url }}">
                        <button type="submit" id="delete">–£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                </div>
            {% empty %}
                <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.</p>
            {% endfor %}
        </section>
    </main>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const inputElements = document.querySelectorAll("#add_procent");
        
            inputElements.forEach(input => {
                input.addEventListener("input", () => {
                    // –£–¥–∞–ª—è–µ–º –≤—Å–µ, –∫—Ä–æ–º–µ —á–∏—Å–µ–ª
                    let value = input.value.replace(/\D/g, "");
        
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ 100
                    if (parseInt(value, 10) > 100) {
                        value = "100";
                    }
        
                    // –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞–∫ `%`, –µ—Å–ª–∏ –µ—Å—Ç—å —á–∏—Å–ª–æ
                    if (value !== "") {
                        input.value = value + "%";
                    } else {
                        input.value = ""; // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–≤–µ–¥–µ–Ω–æ, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–º
                    }
                });
        
                input.addEventListener("keydown", (e) => {
                    // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–ª–∞–≤–∏—à–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è —á–∏—Å–µ–ª
                    const allowedKeys = ["Backspace", "ArrowLeft", "ArrowRight", "Delete", "Tab"];
                    if (!allowedKeys.includes(e.key) && !/^\d$/.test(e.key)) {
                        e.preventDefault();
                    }
                    if (e.key === "Backspace") {
                        let value = input.value.replace("%", ""); // –£–±–∏—Ä–∞–µ–º % –≤—Ä–µ–º–µ–Ω–Ω–æ
                        value = value.slice(0, -1); // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–º–≤–æ–ª
                        if (value === "") {
                            e.preventDefault(); // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ —Å %
                            input.value = "";
                        } else {
                            input.value = value + "%"; // –î–æ–±–∞–≤–ª—è–µ–º % –æ–±—Ä–∞—Ç–Ω–æ
                            e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
                        }
                    }
                });
            });
        });
        
     </script>
</body>
</html>
